@*
    Reusable password input component with toggle functionality and client validation
    Parameters:
    - AspFor: Expression for model binding
    - Label: Display label text
    - AutoComplete: Optional autocomplete attribute (default: "current-password")
    - Required: Whether field is required (shows asterisk)
    - ValidationRules: JSON string of validation rules
    - ErrorMessages: JSON string of error messages
*@
@model dynamic

@{
    var propertyName = ViewData["PropertyName"]?.ToString();
    var currentValue = ViewData["Value"]?.ToString();
    var label = ViewData["Label"]?.ToString();
    var placeholder = ViewData["Placeholder"]?.ToString() ?? "Enter your password";
    var autoComplete = ViewData["AutoComplete"]?.ToString() ?? "current-password";
    var required = ViewData["Required"] is bool req && req;
    var validationRules = ViewData["ValidationRules"]?.ToString() ?? "{}";
    var errorMessages = ViewData["ErrorMessages"]?.ToString() ?? "{}";
    var fieldId = propertyName?.Replace(".", "_") + "-field";
    var errorId = propertyName?.Replace(".", "_") + "-error";
}

<div class="form-group">
    <label for="@fieldId" class="form-label">
        @label
        @if (required)
        {
            <span class="required-asterisk">*</span>
        }
    </label>
    <div class="password-input-wrapper">
        <input type="password" class="form-input password-input" name="@propertyName" id="@fieldId"
            value="@currentValue" placeholder="@placeholder" autocomplete="@autoComplete"
            data-validation-rules="@validationRules" data-error-messages="@errorMessages">
        <button type="button" class="password-toggle" aria-label="Toggle password visibility">
            <svg class="eye-icon show-when-hidden" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <svg class="eye-off-icon show-when-visible" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path
                    d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                </path>
                <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
        </button>
    </div>
    <div class="client-error-text" id="@errorId" style="display: none;"></div>
    <div class="server-error-text"></div>
</div>

@* Include password toggle script only once per page *@
@if (!ViewData.ContainsKey("PasswordToggleScriptLoaded"))
{
    ViewData["PasswordToggleScriptLoaded"] = true;
    <script src="~/js/password-toggle.js"></script>
}