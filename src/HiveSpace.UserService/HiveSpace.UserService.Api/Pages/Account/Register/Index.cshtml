@page
@model HiveSpace.UserService.Api.Pages.Account.Register.Index
@using HiveSpace.UserService.Api.Helpers
@using HiveSpace.UserService.Api.Pages.Account.Register
@using HiveSpace.UserService.Api.Services.Localization
@inject ILocalizationService Localizer
@section Styles {
    <link rel="stylesheet" href="~/css/register.css" />
    <link rel="stylesheet" href="~/css/auth-layout.css" />
}
@section Scripts {
}

@* Start Auth Container *@
@await Html.PartialAsync("_AuthContainer")

@* Language Toggle *@
<partial name="_LanguageToggle" />

<div class="register-header">
    <h1 class="register-title">@Localizer.GetString("pages.register.title")</h1>
    <p class="register-subtitle">@Localizer.GetString("pages.register.subtitle")</p>
</div>
<partial name="_ValidationSummary" />

@if (Model.View.EnableLocalRegistration)
{
    <div>
        @* Social Login Component *@
        @{
            ViewData["Providers"] = Model.View.VisibleExternalProviders;
            ViewData["ReturnUrl"] = Model.Input?.ReturnUrl;
        }
        <partial name="_SocialLogin" />

        <form method="post" class="register-form">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="Input.ReturnUrl" />

            <partial name="_ApiErrors" />

            @* Email Input Component *@
            @{
                ViewData["PropertyName"] = "Input.Email";
                ViewData["Value"] = Model.Input?.Email;
                ViewData["Label"] = Localizer.GetString("pages.register.emailLabel");
                ViewData["Placeholder"] = Localizer.GetString("pages.register.emailPlaceholder");
                ViewData["Type"] = "email";
                ViewData["AutoFocus"] = true;
                ViewData["Required"] = true;
                ViewData["ValidationRules"] = System.Text.Json.JsonSerializer.Serialize(new { required = true, email = true });
                ViewData["ErrorMessages"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = Localizer.GetString("validation.emailRequired"),
                    email = Localizer.GetString("validation.email")
                });
            }
            <partial name="_FormInput" />

            @* Full Name Input Component *@
            @{
                ViewData["PropertyName"] = "Input.FullName";
                ViewData["Value"] = Model.Input?.FullName;
                ViewData["Label"] = Localizer.GetString("pages.register.fullNameLabel");
                ViewData["Placeholder"] = Localizer.GetString("pages.register.fullNamePlaceholder");
                ViewData["Type"] = "text";
                ViewData["AutoComplete"] = "name";
                ViewData["AutoFocus"] = false;
                ViewData["Required"] = true;
                ViewData["ValidationRules"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = true,
                    minLength = 2,
                    maxLength = 100
                });
                ViewData["ErrorMessages"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = Localizer.GetString("validation.fullNameRequired"),
                    minLength = Localizer.GetString("validation.fullNameMinLength", 2),
                    maxLength = Localizer.GetString("validation.fullNameMaxLength", 100)
                });
            }
            <partial name="_FormInput" />

            @* Password Input Component *@
            @{
                ViewData["PropertyName"] = "Input.Password";
                ViewData["Value"] = Model.Input?.Password;
                ViewData["Label"] = Localizer.GetString("pages.register.passwordLabel");
                ViewData["Placeholder"] = Localizer.GetString("pages.register.passwordPlaceholder");
                ViewData["AutoComplete"] = "new-password";
                ViewData["Required"] = true;
                ViewData["ValidationRules"] = System.Text.Json.JsonSerializer.Serialize(new Dictionary<string, object>
                {
                { "required", true },
                { "minlength", 12 },
                { "pattern", @"^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]+$" }
                });
                ViewData["ErrorMessages"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = Localizer.GetString("validation.passwordRequired"),
                    minlength = Localizer.GetString("validation.passwordMinLength", 12),
                    pattern = Localizer.GetString("validation.passwordComplexity")
                });
            }
            <partial name="_PasswordInput" />

            @* Confirm Password Input Component *@
            @{
                ViewData["PropertyName"] = "Input.ConfirmPassword";
                ViewData["Value"] = Model.Input?.ConfirmPassword;
                ViewData["Label"] = Localizer.GetString("pages.register.confirmPasswordLabel");
                ViewData["Placeholder"] = Localizer.GetString("pages.register.confirmPasswordPlaceholder");
                ViewData["AutoComplete"] = "new-password";
                ViewData["Required"] = true;
                ViewData["ValidationRules"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = true,
                    compare = "Input.Password"
                });
                ViewData["ErrorMessages"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = Localizer.GetString("validation.confirmPasswordRequired"),
                    compare = Localizer.GetString("validation.passwordsDoNotMatch")
                });
            }
            <partial name="_PasswordInput" />

            @* Submit Button Component *@
            @{
                ViewData["AspFor"] = Model.Input?.Button;
                ViewData["Value"] = "register";
                ViewData["Text"] = Localizer.GetString("pages.register.createAccountButton");
            }
            <partial name="_SubmitButton" />
        </form>

        <div class="register-footer">
            <div class="signin-text">
                @Localizer.GetString("pages.register.signInText") <a href="/Account/Login@(Request.QueryString)"
                    class="signin-link">@Localizer.GetString("pages.register.signInLink")</a>
            </div>
        </div>
    </div>
}
@* End Auth Container *@
@await Html.PartialAsync("_AuthContainerEnd")

@if (!Model.View.EnableLocalRegistration && !Model.View.VisibleExternalProviders.Any())
{
    <div class="alert alert-warning">
        <strong>@Localizer.GetString("pages.register.invalidRegistrationMessage")</strong>
        @Localizer.GetString("pages.register.noRegistrationMethodsMessage")
    </div>
}