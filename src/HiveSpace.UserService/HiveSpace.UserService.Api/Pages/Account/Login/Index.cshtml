@page
@model HiveSpace.UserService.Api.Pages.Account.Login.Index
@using HiveSpace.UserService.Api.Services.Localization
@inject ILocalizationService Localizer
@section Styles {
    <link rel="stylesheet" href="~/css/login.css" />
    <link rel="stylesheet" href="~/css/auth-layout.css" />
}
@section Scripts {
}

@* Start Auth Container *@
@await Html.PartialAsync("_AuthContainer")

<div class="language-toggle-container">
    @* Language Toggle *@
    <partial name="_LanguageToggle" />
</div>

<div class="login-header">
    <h1 class="login-title">@Localizer.GetString("pages.login.title")</h1>
    <p class="login-subtitle">@Localizer.GetString("pages.login.subtitle")</p>
</div>
<partial name="_ValidationSummary" />

@if (Model.View.EnableLocalLogin)
{
    <div>
        @* Social Login Component *@
        @{
            ViewData["Providers"] = Model.View.VisibleExternalProviders;
            ViewData["ReturnUrl"] = Model.Input?.ReturnUrl;
        }
        <partial name="_SocialLogin" />

        <form method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="Input.ReturnUrl" />

            <partial name="_ApiErrors" />

            @* Email Input Component *@
            @{
                ViewData["PropertyName"] = "Input.Email";
                ViewData["Value"] = Model.Input?.Email;
                ViewData["Label"] = Localizer.GetString("pages.login.emailLabel");
                ViewData["Type"] = "email";
                ViewData["Placeholder"] = Localizer.GetString("pages.login.emailPlaceholder");
                ViewData["AutoComplete"] = "username";
                ViewData["AutoFocus"] = true;
                ViewData["Required"] = true;
                ViewData["ValidationRules"] = System.Text.Json.JsonSerializer.Serialize(new { required = true, email = true });
                ViewData["ErrorMessages"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = Localizer.GetString("validation.emailRequired"),
                    email = Localizer.GetString("validation.email")
                });
            }
            <partial name="_FormInput" />

            @* Password Input Component *@
            @{
                ViewData["PropertyName"] = "Input.Password";
                ViewData["Value"] = Model.Input?.Password;
                ViewData["Label"] = Localizer.GetString("pages.login.passwordLabel");
                ViewData["Placeholder"] = Localizer.GetString("pages.login.passwordPlaceholder");
                ViewData["AutoComplete"] = "current-password";
                ViewData["Required"] = true;
                ViewData["ValidationRules"] = System.Text.Json.JsonSerializer.Serialize(new { required = true });
                ViewData["ErrorMessages"] = System.Text.Json.JsonSerializer.Serialize(new
                {
                    required = Localizer.GetString("validation.passwordRequired")
                });
            }
            <partial name="_PasswordInput" />

            <div class="flex items-center justify-between mb-3">
                @if (Model.View.AllowRememberLogin)
                {
                    @* Remember Me Checkbox Component *@
                    ViewData["PropertyName"] = "Input.RememberLogin";
                    ViewData["Value"] = Model.Input?.RememberLogin;
                    ViewData["Label"] = Localizer.GetString("pages.login.rememberMeLabel");
                    <partial name="_Checkbox" />
                }
                <a href="/Account/ForgotPassword"
                    class="forget-password">@Localizer.GetString("pages.login.forgotPasswordLink")</a>
            </div>

            @* Submit Button Component *@
            @{
                ViewData["AspFor"] = Model.Input?.Button;
                ViewData["Value"] = "login";
                ViewData["Text"] = Localizer.GetString("pages.login.signInButton");
            }
            <partial name="_SubmitButton" />
        </form>

        @if (!Model.View.IsAdminPortalClient)
        {
            <div class="signup-text">
                @Localizer.GetString("pages.login.signUpText") <a href="/Account/Register@(Request.QueryString)"
                    class="signup-link">@Localizer.GetString("pages.login.signUpLink")</a>
            </div>
        }
    </div>
}
@* End Auth Container *@
@await Html.PartialAsync("_AuthContainerEnd")

@if (!Model.View.EnableLocalLogin && !Model.View.VisibleExternalProviders.Any())
{
    <div class="alert alert-warning">
        <strong>@Localizer.GetString("pages.login.invalidLoginMessage")</strong>
        @Localizer.GetString("pages.login.noLoginSchemesMessage")
    </div>
}